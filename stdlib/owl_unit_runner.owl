module OwlUnitRunner {
  fn main() {
    let files = File:ls(test_path())

    List:each(files, run_tests_in\1)
  }

  fn run_tests_in(filename) {
    let actual_filename = File:pwd() ++ "/test_cases/" ++ filename
    let functions = Code:load(actual_filename)

    let filtered = List:filter(functions, test_function?\1)
    List:each(filtered, apply_test_fn\1)
  }

  fn test_file?(filename) {
    String:ends_with?(filename, "_test.owl")
  }

  fn test_function?(fun) {
    let attrs = Function:attrs(fun)
    List:contains?(attrs, "test")
  }

  fn apply_test_fn(test_fn) {
    Function:apply(test_fn, ())
  }

  fn test_path() {
    File:pwd() ++ "/test_cases"
  }
}
